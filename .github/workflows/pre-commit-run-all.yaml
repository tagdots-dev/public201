---
## NOTE: this file is managed through terraform - please do not edit here

name: Pre-Commit-Run-All

on:  # yamllint disable-line rule:truthy
  push:
    branches:
      - test-*

  pull_request:
    branches:
      - main

  workflow_dispatch:

env:
  HADOLINT_VERSION: 'v2.12.0'
  PRE_COMMMIT_VERSION: '4.1.0'
  PYTHON_VERSION: '3.13.2'
  TERRAFORM_VERSION: '1.11.2'
  TFLINT_VERSION: 'v0.55.1'

jobs:
  pre-commit-run-all:
    runs-on: ubuntu-latest

    steps:

    - name: Checkout source code
      uses: actions/checkout@v4

    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PYTHON_VERSION }}

    - name: Install python dependencies
      run: |
        pip install --upgrade pip
        pip install pre_commit==${{ env.PRE_COMMMIT_VERSION }}

    - name: Install hadolint
      run: |
        wget -O hadolint https://github.com/hadolint/hadolint/releases/download/${{ env.HADOLINT_VERSION }}/hadolint-Linux-x86_64
        chmod +x hadolint
        sudo mv hadolint /usr/bin/
        hadolint --version

    - name: Install terraform
      uses: hashicorp/setup-terraform@v3
      with:
        terraform_version: ${{ env.TERRAFORM_VERSION }}

    - name: Install tflint
      uses: terraform-linters/setup-tflint@v4
      with:
        tflint_version: ${{ env.TFLINT_VERSION }}

    - name: Run pre-commit on everything
      run: pre-commit run -a
